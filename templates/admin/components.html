{% extends "admin/base.html" %}

{% block page_title %}Komponenten verwalten{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h4 class="mb-1">Komponenten verwalten</h4>
        <p class="text-muted mb-0">Alle verfügbaren PC-Komponenten</p>
    </div>
    <a href="{{ url_for('admin_add_component') }}" class="btn btn-primary">
        <i class="fas fa-plus"></i> Neue Komponente
    </a>
</div>

<!-- Filters -->
<div class="form-section">
    <form method="GET" class="row g-3 align-items-end">
        <div class="col-md-4">
            <label for="category" class="form-label">Kategorie</label>
            <select name="category" id="category" class="form-select">
                <option value="">Alle Kategorien</option>
                {% for category in categories %}
                <option value="{{ category }}" {% if selected_category == category %}selected{% endif %}>
                    {{ category.title() }}
                </option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3">
            <button type="submit" class="btn btn-outline-primary">
                <i class="fas fa-filter"></i> Filtern
            </button>
            <a href="{{ url_for('admin_components') }}" class="btn btn-outline-secondary">
                <i class="fas fa-times"></i> Zurücksetzen
            </a>
        </div>
    </form>
</div>

<!-- Components Table -->
<div class="form-section">
    {% if components.items %}
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Kategorie</th>
                    <th>Preis</th>
                    <th>Status</th>
                    <th>Erstellt</th>
                    <th>Aktionen</th>
                </tr>
            </thead>
            <tbody>
                {% for component in components.items %}
                <tr>
                    <td>{{ component.id }}</td>
                    <td>
                        <strong>{{ component.name }}</strong>
                        {% if component.get_specs() %}
                        <br><small class="text-muted">
                            {% if component.category == 'cpus' %}
                                {{ component.get_specs().get('socket', '') }} • {{ component.get_specs().get('cores', '') }} Kerne
                            {% elif component.category == 'motherboards' %}
                                {{ component.get_specs().get('socket', '') }} • {{ component.get_specs().get('form_factor', '') }}
                            {% elif component.category == 'ram' %}
                                {{ component.get_specs().get('capacity', '') }}GB {{ component.get_specs().get('type', '') }}
                            {% elif component.category == 'gpus' %}
                                {{ component.get_specs().get('memory', '') }}GB • {{ component.get_specs().get('power_consumption', '') }}W
                            {% endif %}
                        </small>
                        {% endif %}
                    </td>
                    <td>
                        <span class="badge bg-secondary">{{ component.category }}</span>
                    </td>
                    <td>€{{ "%.2f"|format(component.price) }}</td>
                    <td>
                        {% if component.is_active %}
                        <span class="badge bg-success badge-status">Aktiv</span>
                        {% else %}
                        <span class="badge bg-danger badge-status">Inaktiv</span>
                        {% endif %}
                    </td>
                    <td>
                        <small>{{ component.created_at.strftime('%d.%m.%Y') }}</small>
                    </td>
                    <td class="table-actions">
                        <a href="{{ url_for('admin_edit_component', component_id=component.id) }}" 
                           class="btn btn-sm btn-outline-primary" title="Bearbeiten">
                            <i class="fas fa-edit"></i>
                        </a>
                        <button type="button" 
                                class="btn btn-sm btn-outline-danger" 
                                onclick="deleteComponent({{ component.id }}, '{{ component.name }}')"
                                title="Löschen">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    {% if components.pages > 1 %}
    <nav aria-label="Komponenten Pagination">
        <ul class="pagination">
            {% if components.has_prev %}
            <li class="page-item">
                <a class="page-link" href="{{ url_for('admin_components', page=components.prev_num, category=selected_category) }}">Zurück</a>
            </li>
            {% endif %}
            
            {% for page_num in components.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
                {% if page_num %}
                    {% if page_num != components.page %}
                    <li class="page-item">
                        <a class="page-link" href="{{ url_for('admin_components', page=page_num, category=selected_category) }}">{{ page_num }}</a>
                    </li>
                    {% else %}
                    <li class="page-item active">
                        <span class="page-link">{{ page_num }}</span>
                    </li>
                    {% endif %}
                {% else %}
                <li class="page-item disabled">
                    <span class="page-link">...</span>
                </li>
                {% endif %}
            {% endfor %}
            
            {% if components.has_next %}
            <li class="page-item">
                <a class="page-link" href="{{ url_for('admin_components', page=components.next_num, category=selected_category) }}">Weiter</a>
            </li>
            {% endif %}
        </ul>
    </nav>
    {% endif %}

    {% else %}
    <div class="text-center py-5">
        <i class="fas fa-microchip text-muted" style="font-size: 4rem;"></i>
        <h5 class="mt-3 text-muted">Keine Komponenten gefunden</h5>
        <p class="text-muted">
            {% if selected_category %}
            Keine Komponenten in der Kategorie "{{ selected_category }}" vorhanden.
            {% else %}
            Noch keine Komponenten erstellt.
            {% endif %}
        </p>
        <a href="{{ url_for('admin_add_component') }}" class="btn btn-primary">
            <i class="fas fa-plus"></i> Erste Komponente hinzufügen
        </a>
    </div>
    {% endif %}
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Komponente löschen</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Sind Sie sicher, dass Sie die Komponente <strong id="componentName"></strong> löschen möchten?</p>
                <p class="text-danger">
                    <i class="fas fa-exclamation-triangle"></i>
                    Diese Aktion kann nicht rückgängig gemacht werden.
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Abbrechen</button>
                <form method="POST" id="deleteForm" style="display: inline;">
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-trash"></i> Löschen
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function deleteComponent(componentId, componentName) {
    document.getElementById('componentName').textContent = componentName;
    document.getElementById('deleteForm').action = `/admin/components/${componentId}/delete`;
    
    const modal = new bootstrap.Modal(document.getElementById('deleteModal'));
    modal.show();
}
</script>
{% endblock %}