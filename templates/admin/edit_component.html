{% extends "admin/base.html" %}

{% block title %}Komponente bearbeiten{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Komponente bearbeiten</h2>
    <a href="{{ url_for('admin_components') }}" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> Zurück zur Liste
    </a>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-body">
                <form method="POST">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="name" class="form-label">Name</label>
                                <input type="text" class="form-control" id="name" name="name" value="{{ component.name }}" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="category" class="form-label">Kategorie</label>
                                <select class="form-select" id="category" name="category" required>
                                    <option value="cpus" {{ 'selected' if component.category == 'cpus' }}>CPUs</option>
                                    <option value="motherboards" {{ 'selected' if component.category == 'motherboards' }}>Motherboards</option>
                                    <option value="ram" {{ 'selected' if component.category == 'ram' }}>RAM</option>
                                    <option value="gpus" {{ 'selected' if component.category == 'gpus' }}>GPUs</option>
                                    <option value="ssds" {{ 'selected' if component.category == 'ssds' }}>SSDs</option>
                                    <option value="cases" {{ 'selected' if component.category == 'cases' }}>Gehäuse</option>
                                    <option value="psus" {{ 'selected' if component.category == 'psus' }}>Netzteile</option>
                                    <option value="coolers" {{ 'selected' if component.category == 'coolers' }}>Kühler</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="price" class="form-label">Preis (€)</label>
                                <input type="number" step="0.01" class="form-control" id="price" name="price" value="{{ component.price }}" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="is_active" class="form-label">Status</label>
                                <select class="form-select" id="is_active" name="is_active">
                                    <option value="1" {{ 'selected' if component.is_active }}>Aktiv</option>
                                    <option value="0" {{ 'selected' if not component.is_active }}>Inaktiv</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="specifications" class="form-label">Spezifikationen (JSON)</label>
                        <textarea class="form-control" id="specifications" name="specifications" rows="8" required>{{ component.specifications }}</textarea>
                        <div class="form-text">Geben Sie die Spezifikationen im JSON-Format ein. Beispiel: {"socket": "AM5", "cores": 8}</div>
                    </div>

                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Speichern
                        </button>
                        <a href="{{ url_for('admin_components') }}" class="btn btn-secondary">Abbrechen</a>
                        <a href="{{ url_for('admin_delete_component', component_id=component.id) }}" 
                           class="btn btn-danger ms-auto" 
                           onclick="return confirm('Sind Sie sicher, dass Sie diese Komponente löschen möchten?')">
                            <i class="fas fa-trash"></i> Löschen
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">Aktuelle Spezifikationen</h6>
            </div>
            <div class="card-body">
                {% set specs = component.get_specs() %}
                {% if specs %}
                    <ul class="list-group list-group-flush">
                        {% for key, value in specs.items() %}
                        <li class="list-group-item d-flex justify-content-between">
                            <strong>{{ key }}:</strong>
                            <span>{{ value }}</span>
                        </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p class="text-muted">Keine Spezifikationen verfügbar</p>
                {% endif %}
            </div>
        </div>

        <div class="card mt-3">
            <div class="card-header">
                <h6 class="mb-0">Informationen</h6>
            </div>
            <div class="card-body">
                <p><strong>ID:</strong> {{ component.id }}</p>
                <p><strong>Erstellt:</strong> {{ component.created_at.strftime('%d.%m.%Y %H:%M') }}</p>
                <p><strong>Aktualisiert:</strong> {{ component.updated_at.strftime('%d.%m.%Y %H:%M') }}</p>
                <p><strong>Status:</strong> 
                    <span class="badge bg-{{ 'success' if component.is_active else 'secondary' }}">
                        {{ 'Aktiv' if component.is_active else 'Inaktiv' }}
                    </span>
                </p>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const categorySelect = document.getElementById('category');
    const specsTextarea = document.getElementById('specifications');
    
    // JSON-Validierung
    specsTextarea.addEventListener('blur', function() {
        try {
            JSON.parse(this.value);
            this.classList.remove('is-invalid');
            this.classList.add('is-valid');
        } catch (e) {
            this.classList.remove('is-valid');
            this.classList.add('is-invalid');
        }
    });
});
</script>
{% endblock %}