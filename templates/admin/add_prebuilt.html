{% extends "admin/base.html" %}

{% block page_title %}Neuen Fertig-PC hinzufügen{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h4 class="mb-1">Neuen Fertig-PC hinzufügen</h4>
        <p class="text-muted mb-0">Erstellen Sie einen neuen Fertig-PC für die Website</p>
    </div>
    <a href="{{ url_for('admin_prebuilts') }}" class="btn btn-outline-secondary">
        <i class="fas fa-arrow-left"></i> Zurück zur Übersicht
    </a>
</div>

<form method="POST" class="needs-validation" novalidate>
    <!-- Basic Information -->
    <div class="form-section">
        <h5 class="mb-3">
            <i class="fas fa-info-circle"></i> Grundinformationen
        </h5>
        
        <div class="row">
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="name" class="form-label">Name *</label>
                    <input type="text" 
                           class="form-control" 
                           id="name" 
                           name="name" 
                           placeholder="z.B. Gaming Beast Pro 2024"
                           required>
                    <div class="invalid-feedback">
                        Bitte geben Sie einen Namen ein.
                    </div>
                </div>
            </div>
            
            <div class="col-md-3">
                <div class="mb-3">
                    <label for="category" class="form-label">Kategorie *</label>
                    <select class="form-select" id="category" name="category" required>
                        <option value="">Kategorie wählen</option>
                        <option value="gaming">Gaming</option>
                        <option value="workstation">Workstation</option>
                        <option value="office">Office</option>
                    </select>
                    <div class="invalid-feedback">
                        Bitte wählen Sie eine Kategorie.
                    </div>
                </div>
            </div>
            
            <div class="col-md-3">
                <div class="mb-3">
                    <label for="price" class="form-label">Preis (€) *</label>
                    <div class="input-group">
                        <span class="input-group-text">€</span>
                        <input type="number" 
                               class="form-control" 
                               id="price" 
                               name="price" 
                               step="0.01" 
                               min="0"
                               placeholder="1299.99"
                               required>
                    </div>
                    <div class="invalid-feedback">
                        Bitte geben Sie einen gültigen Preis ein.
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="image_url" class="form-label">Bild-URL</label>
                    <input type="url" 
                           class="form-control" 
                           id="image_url" 
                           name="image_url" 
                           placeholder="https://example.com/image.jpg">
                    <div class="form-text">Optional: URL zu einem Produktbild</div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="description" class="form-label">Beschreibung *</label>
                    <textarea class="form-control" 
                              id="description" 
                              name="description" 
                              rows="3" 
                              placeholder="Kurze Beschreibung des Fertig-PCs..."
                              required></textarea>
                    <div class="invalid-feedback">
                        Bitte geben Sie eine Beschreibung ein.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Specifications -->
    <div class="form-section">
        <h5 class="mb-3">
            <i class="fas fa-cogs"></i> Spezifikationen
        </h5>
        
        <div class="row">
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="cpu" class="form-label">CPU (Prozessor) *</label>
                    <input type="text" 
                           class="form-control" 
                           id="cpu" 
                           name="cpu" 
                           placeholder="z.B. AMD Ryzen 7 7800X3D"
                           required>
                    <div class="invalid-feedback">
                        Bitte geben Sie eine CPU an.
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="gpu" class="form-label">GPU (Grafikkarte) *</label>
                    <input type="text" 
                           class="form-control" 
                           id="gpu" 
                           name="gpu" 
                           placeholder="z.B. RTX 4080 Super 16GB"
                           required>
                    <div class="invalid-feedback">
                        Bitte geben Sie eine GPU an.
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="ram" class="form-label">RAM (Arbeitsspeicher) *</label>
                    <input type="text" 
                           class="form-control" 
                           id="ram" 
                           name="ram" 
                           placeholder="z.B. 32GB DDR5-5600"
                           required>
                    <div class="invalid-feedback">
                        Bitte geben Sie die RAM-Konfiguration an.
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="storage" class="form-label">Speicher *</label>
                    <input type="text" 
                           class="form-control" 
                           id="storage" 
                           name="storage" 
                           placeholder="z.B. 1TB NVMe SSD"
                           required>
                    <div class="invalid-feedback">
                        Bitte geben Sie die Speicher-Konfiguration an.
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="motherboard" class="form-label">Motherboard *</label>
                    <input type="text" 
                           class="form-control" 
                           id="motherboard" 
                           name="motherboard" 
                           placeholder="z.B. ASUS ROG Strix X670E-E"
                           required>
                    <div class="invalid-feedback">
                        Bitte geben Sie das Motherboard an.
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="cooler" class="form-label">Kühler *</label>
                    <input type="text" 
                           class="form-control" 
                           id="cooler" 
                           name="cooler" 
                           placeholder="z.B. Noctua NH-D15"
                           required>
                    <div class="invalid-feedback">
                        Bitte geben Sie den Kühler an.
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="case" class="form-label">Gehäuse *</label>
                    <input type="text" 
                           class="form-control" 
                           id="case" 
                           name="case" 
                           placeholder="z.B. Fractal Design Define 7"
                           required>
                    <div class="invalid-feedback">
                        Bitte geben Sie das Gehäuse an.
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="psu" class="form-label">Netzteil *</label>
                    <input type="text" 
                           class="form-control" 
                           id="psu" 
                           name="psu" 
                           placeholder="z.B. Corsair RM850x 850W 80+ Gold"
                           required>
                    <div class="invalid-feedback">
                        Bitte geben Sie das Netzteil an.
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Hidden field for specifications JSON -->
        <input type="hidden" id="specifications" name="specifications" value="{}">
    </div>

    <!-- Features -->
    <div class="form-section">
        <h5 class="mb-3">
            <i class="fas fa-star"></i> Features
        </h5>
        
        <div class="mb-3">
            <label for="features_text" class="form-label">Features Liste *</label>
            <textarea class="form-control" 
                      id="features_text" 
                      name="features_text" 
                      rows="6" 
                      placeholder="Ein Feature pro Zeile:
Ultra-hochauflösendes Gaming in 4K
Ray Tracing unterstützt
Whisper-leise Kühlung
RGB-Beleuchtung
Windows 11 Pro vorinstalliert
3 Jahre Garantie"
                      required></textarea>
            <div class="form-text">Geben Sie jedes Feature in einer separaten Zeile ein.</div>
            <div class="invalid-feedback">
                Bitte geben Sie mindestens ein Feature an.
            </div>
        </div>
        
        <!-- Hidden field for features JSON -->
        <input type="hidden" id="features" name="features" value="[]">
    </div>

    <!-- Submit Button -->
    <div class="form-section">
        <div class="d-flex justify-content-between">
            <a href="{{ url_for('admin_prebuilts') }}" class="btn btn-outline-secondary">
                <i class="fas fa-times"></i> Abbrechen
            </a>
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i> Fertig-PC speichern
            </button>
        </div>
    </div>
</form>
{% endblock %}

{% block scripts %}
<script>
// Collect form data for JSON fields
function collectFormData() {
    // Collect specifications
    const specs = {
        cpu: document.getElementById('cpu').value,
        gpu: document.getElementById('gpu').value,
        ram: document.getElementById('ram').value,
        storage: document.getElementById('storage').value,
        motherboard: document.getElementById('motherboard').value,
        cooler: document.getElementById('cooler').value,
        case: document.getElementById('case').value,
        psu: document.getElementById('psu').value
    };
    
    // Collect features from textarea
    const featuresText = document.getElementById('features_text').value;
    const features = featuresText.split('\n')
        .map(line => line.trim())
        .filter(line => line.length > 0);
    
    // Update hidden fields
    document.getElementById('specifications').value = JSON.stringify(specs);
    document.getElementById('features').value = JSON.stringify(features);
}

// Form validation
(function() {
    'use strict';
    window.addEventListener('load', function() {
        const forms = document.getElementsByClassName('needs-validation');
        Array.prototype.filter.call(forms, function(form) {
            form.addEventListener('submit', function(event) {
                // Collect data before validation
                collectFormData();
                
                if (form.checkValidity() === false) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                form.classList.add('was-validated');
            }, false);
        });
    }, false);
})();

// Image preview
document.getElementById('image_url').addEventListener('input', function(e) {
    const url = e.target.value;
    const preview = document.getElementById('image-preview');
    
    if (preview) {
        preview.remove();
    }
    
    if (url) {
        const img = document.createElement('img');
        img.id = 'image-preview';
        img.src = url;
        img.className = 'img-fluid mt-2';
        img.style.maxHeight = '200px';
        img.style.borderRadius = '8px';
        img.onerror = function() {
            this.style.display = 'none';
        };
        
        e.target.parentNode.appendChild(img);
    }
});
</script>
{% endblock %}