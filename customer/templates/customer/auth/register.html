{% extends "base.html" %}

{% block title %}Registrieren - ByteDohm.de{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-7">
            <div class="card shadow">
                <div class="card-body p-5">
                    <div class="text-center mb-4">
                        <h1 class="h3 mb-3">Konto erstellen</h1>
                        <p class="text-muted">Erstellen Sie Ihr ByteDohm Kundenkonto</p>
                    </div>

                    <form method="POST" id="registerForm">
                        <!-- Personal Information -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="mb-3">Persönliche Daten</h5>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="first_name" class="form-label">Vorname *</label>
                                    <input type="text" class="form-control" id="first_name" name="first_name" required
                                           value="{{ request.form.first_name or '' }}">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="last_name" class="form-label">Nachname *</label>
                                    <input type="text" class="form-control" id="last_name" name="last_name" required
                                           value="{{ request.form.last_name or '' }}">
                                </div>
                            </div>
                        </div>

                        <!-- Contact Information -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="email" class="form-label">E-Mail-Adresse *</label>
                                    <input type="email" class="form-control" id="email" name="email" required
                                           value="{{ request.form.email or '' }}" autocomplete="username">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="phone" class="form-label">Telefonnummer</label>
                                    <input type="tel" class="form-control" id="phone" name="phone"
                                           value="{{ request.form.phone or '' }}">
                                </div>
                            </div>
                        </div>

                        <!-- Address Information -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="mb-3">Adresse</h5>
                            </div>
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label for="street" class="form-label">Straße</label>
                                    <input type="text" class="form-control" id="street" name="street"
                                           value="{{ request.form.street or '' }}">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="house_number" class="form-label">Hausnummer</label>
                                    <input type="text" class="form-control" id="house_number" name="house_number"
                                           value="{{ request.form.house_number or '' }}">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="postal_code" class="form-label">PLZ</label>
                                    <input type="text" class="form-control" id="postal_code" name="postal_code"
                                           value="{{ request.form.postal_code or '' }}">
                                </div>
                            </div>
                            <div class="col-md-5">
                                <div class="mb-3">
                                    <label for="city" class="form-label">Stadt</label>
                                    <input type="text" class="form-control" id="city" name="city"
                                           value="{{ request.form.city or '' }}">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label for="country" class="form-label">Land</label>
                                    <input type="text" class="form-control" id="country" name="country"
                                           value="{{ request.form.country or 'Deutschland' }}">
                                </div>
                            </div>
                        </div>

                        <!-- Password -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="mb-3">Passwort</h5>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="password" class="form-label">Passwort *</label>
                                    <input type="password" class="form-control" id="password" name="password" required
                                           autocomplete="new-password">
                                    <div class="form-text">
                                        Mindestens 8 Zeichen, mit Groß-, Kleinbuchstaben und Zahlen
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="password_confirm" class="form-label">Passwort bestätigen *</label>
                                    <input type="password" class="form-control" id="password_confirm" name="password_confirm" required
                                           autocomplete="new-password">
                                </div>
                            </div>
                        </div>

                        <!-- Terms and Newsletter -->
                        <div class="mb-4">
                            <div class="form-check mb-3">
                                <input type="checkbox" class="form-check-input" id="terms" name="terms" required>
                                <label class="form-check-label" for="terms">
                                    Ich akzeptiere die <a href="#" target="_blank">Allgemeinen Geschäftsbedingungen</a> 
                                    und die <a href="#" target="_blank">Datenschutzerklärung</a> *
                                </label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="newsletter" name="newsletter"
                                       {{ 'checked' if request.form.newsletter else '' }}>
                                <label class="form-check-label" for="newsletter">
                                    Ich möchte den Newsletter mit Angeboten und News erhalten
                                </label>
                            </div>
                        </div>

                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-user-plus me-2"></i>Konto erstellen
                            </button>
                        </div>
                    </form>

                    <hr class="my-4">

                    <div class="text-center">
                        <span class="text-muted">Bereits ein Konto?</span>
                        <a href="{{ url_for('customer_auth.login') }}" class="text-decoration-none">
                            Jetzt anmelden
                        </a>
                    </div>
                </div>
            </div>

            <div class="text-center mt-4">
                <a href="{{ url_for('index') }}" class="text-decoration-none">
                    <i class="fas fa-arrow-left me-2"></i>Zurück zur Startseite
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('registerForm');
    const password = document.getElementById('password');
    const passwordConfirm = document.getElementById('password_confirm');
    
    // Password strength indicator
    password.addEventListener('input', function() {
        checkPasswordStrength();
    });
    
    // Password confirmation
    passwordConfirm.addEventListener('input', function() {
        checkPasswordMatch();
    });
    
    function checkPasswordStrength() {
        const pwd = password.value;
        const strength = document.getElementById('password-strength') || createStrengthIndicator();
        
        let score = 0;
        if (pwd.length >= 8) score++;
        if (/[a-z]/.test(pwd)) score++;
        if (/[A-Z]/.test(pwd)) score++;
        if (/[0-9]/.test(pwd)) score++;
        
        const levels = ['Schwach', 'Mittel', 'Stark', 'Sehr stark'];
        const colors = ['danger', 'warning', 'info', 'success'];
        
        strength.textContent = levels[score - 1] || 'Zu schwach';
        strength.className = `badge bg-${colors[score - 1] || 'danger'}`;
    }
    
    function createStrengthIndicator() {
        const indicator = document.createElement('span');
        indicator.id = 'password-strength';
        indicator.className = 'badge bg-danger';
        password.parentNode.appendChild(indicator);
        return indicator;
    }
    
    function checkPasswordMatch() {
        if (password.value !== passwordConfirm.value) {
            passwordConfirm.setCustomValidity('Passwörter stimmen nicht überein');
        } else {
            passwordConfirm.setCustomValidity('');
        }
    }
    
    // Form validation
    form.addEventListener('submit', function(e) {
        if (password.value !== passwordConfirm.value) {
            e.preventDefault();
            alert('Passwörter stimmen nicht überein.');
        }
    });
});
</script>
{% endblock %}